<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resources - Mental Health Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            min-height: 100vh;
        }

        .navbar{
         background: linear-gradient(90deg, #b2cfe8 0%, #4a6567 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .page-header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .page-header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .page-header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .resource-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
            cursor: pointer;
            background: linear-gradient(135deg, #fef9f3, #e0f0f5);
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.15s ease-in-out;
        }
        
        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #6B73FF;
        }
        
        .resource-card.interactive {
            cursor: default;
        }
        
        .resource-card.interactive:hover {
            transform: none;
            border-color: transparent;
        }
        
        .resource-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 20px;
        }
        
        .resource-icon.meditation { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .resource-icon.exercise { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .resource-icon.therapy { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .resource-icon.breathing { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .resource-icon.sleep { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .resource-icon.nutrition { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        
        .resource-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .resource-card p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .resource-card .category {
            display: inline-block;
            background: #e9ecef;
            color: #495057;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .card:hover {
         box-shadow: 0 0.5rem 1rem var(--shadow);
        }
        .resource-link {
            color: #6B73FF;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .resource-link:hover {
            text-decoration: underline;
        }
        
        .featured-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .featured-section h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .featured-resources {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .featured-resource {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #6B73FF;
        }
        
        .featured-resource h4 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .featured-resource p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .crisis-section {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .crisis-section h2 {
            margin-bottom: 15px;
        }
        
        .crisis-section p {
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .crisis-btn {
            background: white;
            color: #ff6b6b;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .crisis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,255,255,0.3);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6B73FF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .meditation-container, .exercise-container {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
        }
        
        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            transition: all 2s ease-in-out;
            animation: pulse 4s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .breathing-text {
            font-size: 2rem;
            font-weight: 600;
            color: #6B73FF;
            margin: 20px 0;
            min-height: 60px;
        }
        
        .timer {
            font-size: 3rem;
            font-weight: 700;
            color: #6B73FF;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .exercise-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .exercise-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .exercise-item:hover {
            border-color: #6B73FF;
            transform: translateY(-2px);
        }
        
        .exercise-item.selected {
            border-color: #6B73FF;
            background: #f0f4ff;
        }
        
        .exercise-item i {
            font-size: 2rem;
            color: #6B73FF;
            margin-bottom: 10px;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .control-btn {
            background: linear-gradient(135deg, #6B73FF 0%, #8B5CF6 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(107, 115, 255, 0.4);
        }
        
        .control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .control-btn.secondary {
            background: #6c757d;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #6B73FF 0%, #8B5CF6 100%);
            width: 0%;
            transition: width 1s linear;
        }
        
        .meditation-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 600;
            color: #6B73FF;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Nutrition Styles */
        .nutrition-container, .therapist-container, .breathing-methods-container {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .nutrition-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab-btn.active {
            border-bottom-color: #6B73FF;
            color: #6B73FF;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .meal-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .meal-input input, .meal-input select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            flex: 1;
            min-width: 150px;
        }
        
        .meal-input button {
            background: #6B73FF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .meals-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .meal-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .foods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .food-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .food-item:hover {
            border-color: #6B73FF;
            transform: translateY(-2px);
        }
        
        .food-item i {
            font-size: 2rem;
            color: #6B73FF;
            margin-bottom: 10px;
        }
        
        .water-tracker {
            text-align: center;
            margin-top: 20px;
        }
        
        .water-glasses {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .water-glass {
            width: 40px;
            height: 60px;
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 0 0 20px 20px;
            position: relative;
        }
        
        .water-glass.filled {
            background: linear-gradient(to top, #2196f3, #64b5f6);
        }
        
        /* Therapist Styles */
        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #333;
        }
        
        .filter-group input, .filter-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .therapists-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .therapist-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            gap: 20px;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .therapist-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #6B73FF 0%, #8B5CF6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .therapist-info {
            flex: 1;
        }
        
        .therapist-info h4 {
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .specialization {
            color: #6B73FF;
            font-weight: 600;
            margin: 5px 0;
        }
        
        .location {
            color: #666;
            margin: 5px 0;
        }
        
        .therapist-tags {
            display: flex;
            gap: 5px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .tag {
            background: #f0f4ff;
            color: #6B73FF;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .therapist-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
        }
        
        .therapist-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        /* Breathing Methods Styles */
        .breathing-methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .breathing-method {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .breathing-method:hover {
            border-color: #6B73FF;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(107, 115, 255, 0.2);
        }
        
        .method-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #6B73FF 0%, #8B5CF6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin: 0 auto 15px;
        }
        
        .breathing-method h4 {
            color: #333;
            margin: 10px 0;
        }
        
        .breathing-method p {
            color: #666;
            margin: 5px 0;
        }
        
        .breathing-method small {
            color: #6B73FF;
            font-weight: 600;
        }
        
        .breathing-practice {
            margin-top: 30px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            text-align: center;
        }
        
        .breathing-steps {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .step-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .step-indicator.active {
            background: #6B73FF;
            color: white;
            transform: scale(1.1);
        }
        
        .step-indicator.completed {
            background: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand text-white" href="/dashboard">
                <i class="fas fa-brain"></i>
                Mental Health Platform
            </a>
            <div class="navbar-nav ms-auto">
                <a href="/dashboard" class="nav-link text-white">Dashboard</a>
                <a href="/mood" class="nav-link text-white">Mood</a>
                <a href="/journal" class="nav-link text-white">Journal</a>
                <a href="/resources" class="nav-link active text-white">Resources</a>
                <a href="/analytics" class="nav-link text-white">Analytics</a>
                <a href="/profile" class="nav-link text-white">Profile</a>
                <a href="#" onclick="logout()" class="nav-link text-white">Logout</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-lightbulb"></i> Mental Health Resources</h1>
            <p>Access helpful resources and tools for your mental health journey</p>
        </div>
        
        <div class="crisis-section">
            <h2><i class="fas fa-exclamation-triangle"></i> Need Immediate Help?</h2>
            <p>If you're experiencing a mental health crisis, help is available 24/7</p>
            <a href="tel:988" class="crisis-btn">
                <i class="fas fa-phone"></i> Call 988 (Suicide & Crisis Lifeline)
            </a>
        </div>
        
        <div class="featured-section">
            <h2><i class="fas fa-star"></i> Featured Resources</h2>
            <div class="featured-resources" id="featuredResources">
                <div style="text-align: center; color: #666; padding: 20px;">
                    <i class="fas fa-spinner fa-spin"></i> Loading featured resources...
                </div>
            </div>
        </div>
        
        <div class="resources-grid">
            <div class="resource-card interactive" onclick="showMeditation()">
                <div class="resource-icon meditation">
                    <i class="fas fa-om"></i>
                </div>
                <div class="category">Meditation & Mindfulness</div>
                <h3>Guided Meditation</h3>
                <p>Learn meditation techniques to reduce stress and improve mental clarity. Practice mindfulness exercises designed for beginners.</p>
                <button class="btn" onclick="showMeditation()">
                    <i class="fas fa-play"></i> Start Meditation
                </button>
                
                <div class="meditation-container" id="meditationContainer">
                    <h3><i class="fas fa-om"></i> Breathing Exercise</h3>
                    <p>Follow the breathing pattern to relax and center yourself</p>
                    
                    <div class="breathing-circle" id="breathingCircle">
                        <span id="breathingInstruction">Ready</span>
                    </div>
                    
                    <div class="breathing-text" id="breathingText">Click Start to begin</div>
                    
                    <div class="control-buttons">
                        <button class="control-btn" id="startMeditationBtn" onclick="startMeditation()">
                            <i class="fas fa-play"></i> Start
                        </button>
                        <button class="control-btn secondary" id="pauseMeditationBtn" onclick="pauseMeditation()" disabled>
                            <i class="fas fa-pause"></i> Pause
                        </button>
                        <button class="control-btn secondary" id="stopMeditationBtn" onclick="stopMeditation()" disabled>
                            <i class="fas fa-stop"></i> Stop
                        </button>
                    </div>

                   <audio id="breathingSound" src="{{ url_for('static', filename='inhale-exhale.mp3') }}" preload="auto"></audio>

                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="meditationProgress"></div>
                    </div>
                    
                    <div class="meditation-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="breathCount">0</div>
                            <div class="stat-label">Breaths</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="meditationTime">00:00</div>
                            <div class="stat-label">Time</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="sessionCount">0</div>
                            <div class="stat-label">Sessions</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="resource-card interactive" onclick="showExercise()">
                <div class="resource-icon exercise">
                    <i class="fas fa-running"></i>
                </div>
                <div class="category">Physical Activity</div>
                <h3>Exercise for Mental Health</h3>
                <p>Discover how physical activity can boost your mood and reduce symptoms of anxiety and depression.</p>
                <button class="btn" onclick="showExercise()">
                    <i class="fas fa-dumbbell"></i> Start Exercise
                </button>
                
                <div class="exercise-container" id="exerciseContainer">
                    <h3><i class="fas fa-running"></i> Quick Exercise Session</h3>
                    <p>Choose an exercise and set a timer to get moving</p>
                    
                    <div class="exercise-list">
                        <div class="exercise-item" onclick="selectExercise('jumping-jacks')">
                            <i class="fas fa-child"></i>
                            <div>Jumping Jacks</div>
                            <small>5 min</small>
                        </div>
                        <div class="exercise-item" onclick="selectExercise('push-ups')">
                            <i class="fas fa-dumbbell"></i>
                            <div>Push-ups</div>
                            <small>3 min</small>
                        </div>
                        <div class="exercise-item" onclick="selectExercise('squats')">
                            <i class="fas fa-walking"></i>
                            <div>Squats</div>
                            <small>4 min</small>
                        </div>
                        <div class="exercise-item" onclick="selectExercise('plank')">
                            <i class="fas fa-stopwatch"></i>
                            <div>Plank</div>
                            <small>2 min</small>
                        </div>
                        <div class="exercise-item" onclick="selectExercise('burpees')">
                            <i class="fas fa-fire"></i>
                            <div>Burpees</div>
                            <small>5 min</small>
                        </div>
                        <div class="exercise-item" onclick="selectExercise('custom')">
                            <i class="fas fa-cog"></i>
                            <div>Custom</div>
                            <small>Set time</small>
                        </div>
                    </div>
                    
                    <div id="exerciseTimer" class="timer" style="display: none;">00:00</div>
                    
                    <div class="control-buttons">
                        <button class="control-btn" id="startExerciseBtn" onclick="startExercise()" disabled>
                            <i class="fas fa-play"></i> Start Exercise
                        </button>
                        <button class="control-btn secondary" id="pauseExerciseBtn" onclick="pauseExercise()" disabled>
                            <i class="fas fa-pause"></i> Pause
                        </button>
                        <button class="control-btn secondary" id="stopExerciseBtn" onclick="stopExercise()" disabled>
                            <i class="fas fa-stop"></i> Stop
                        </button>
                    </div>
                    
                    <div class="progress-bar" id="exerciseProgressBar" style="display: none;">
                        <div class="progress-fill" id="exerciseProgress"></div>
                    </div>
                    
                    <div id="exerciseInstructions" style="margin-top: 20px; padding: 15px; background: white; border-radius: 10px; display: none;">
                        <h4 id="exerciseTitle">Exercise Instructions</h4>
                        <p id="exerciseDescription">Select an exercise to see instructions</p>
                    </div>
                </div>
            </div>
            
            
         
            
                        
            <div class="resource-card">
                <div class="resource-icon sleep">
                    <i class="fas fa-moon"></i>
                </div>
                <div class="category">Sleep Hygiene</div>
                <h3>Better Sleep Habits</h3>
                <p>Improve your sleep quality with proven techniques and habits that support mental health.</p>
                <a href="#" class="resource-link">
                    <i class="fas fa-bed"></i> Sleep Tips
                </a>
            </div>
            
            <div class="resource-card interactive" onclick="showNutrition()">
                <div class="resource-icon nutrition">
                    <i class="fas fa-apple-alt"></i>
                </div>
                <div class="category">Nutrition & Diet</div>
                <h3>Mental Health Nutrition</h3>
                <p>Discover how proper nutrition affects your mental health. Track your meals and learn about mood-boosting foods.</p>
                <button class="btn" onclick="showNutrition()">
                    <i class="fas fa-utensils"></i> Track Nutrition
                </button>
                
                <div class="nutrition-container" id="nutritionContainer">
                    <h3><i class="fas fa-apple-alt"></i> Nutrition Tracker</h3>
                    <p>Track your daily nutrition and discover mood-boosting foods</p>
                    
                    <div class="nutrition-tabs">
                        <button class="tab-btn active" onclick="showNutritionTab('tracker')">Daily Tracker</button>
                        <button class="tab-btn" onclick="showNutritionTab('foods')">Mood Foods</button>
                        <button class="tab-btn" onclick="showNutritionTab('water')">Hydration</button>
                    </div>
                    
                    <div class="tab-content active" id="trackerTab">
                        <div class="meal-tracker">
                            <h4>Today's Meals</h4>
                            <div class="meal-input">
                                <input type="text" id="mealName" placeholder="What did you eat?">
                                <select id="mealType">
                                    <option value="breakfast">Breakfast</option>
                                    <option value="lunch">Lunch</option>
                                    <option value="dinner">Dinner</option>
                                    <option value="snack">Snack</option>
                                </select>
                                <button onclick="addMealAsync()">Add Meal</button>
                            </div>
                            <div class="meals-list" id="mealsList"></div>
                        </div>
                        
                        <div class="nutrition-stats">
                            <div class="stat-card">
                                <div class="stat-number" id="mealsCount">0</div>
                                <div class="stat-label">Meals Today</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="waterGlasses">0</div>
                                <div class="stat-label">Water Glasses</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="moodScore">😊</div>
                                <div class="stat-label">Mood</div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="resetDailyData()" class="control-btn secondary" style="background: #6c757d;">
                                <i class="fas fa-redo"></i> Reset Daily Data
                            </button>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="foodsTab">
                        <h4>Mood-Boosting Foods</h4>
                        <div class="foods-grid">
                            <div class="food-item">
                                <i class="fas fa-fish"></i>
                                <h5>Omega-3 Rich Foods</h5>
                                <p>Salmon, walnuts, flaxseeds</p>
                                <small>Reduces anxiety & depression</small>
                            </div>
                            <div class="food-item">
                                <i class="fas fa-leaf"></i>
                                <h5>Leafy Greens</h5>
                                <p>Spinach, kale, broccoli</p>
                                <small>High in folate & B vitamins</small>
                            </div>
                            <div class="food-item">
                                <i class="fas fa-seedling"></i>
                                <h5>Probiotics</h5>
                                <p>Yogurt, kefir, sauerkraut</p>
                                <small>Supports gut-brain connection</small>
                            </div>
                            <div class="food-item">
                                <i class="fas fa-seedling"></i>
                                <h5>Dark Chocolate</h5>
                                <p>70%+ cocoa content</p>
                                <small>Boosts serotonin levels</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="waterTab">
                        <h4>Hydration Tracker</h4>
                        <div class="water-tracker">
                            <div class="water-display">
                                <div class="water-glasses" id="waterGlassesDisplay"></div>
                                <div class="water-goal">Goal: 8 glasses</div>
                            </div>
                            <div class="water-controls">
                                <button onclick="addWaterAsync()" class="control-btn">
                                    <i class="fas fa-plus"></i> Add Glass
                                </button>
                                <button onclick="resetWaterAsync()" class="control-btn secondary">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="resource-card interactive" onclick="showTherapist()">
                <div class="resource-icon therapy">
                    <i class="fas fa-user-md"></i>
                </div>
                <div class="category">Professional Help</div>
                <h3>Find a Therapist</h3>
                <p>Connect with mental health professionals in your area. Get personalized recommendations based on your needs.</p>
                <button class="btn" onclick="showTherapist()">
                    <i class="fas fa-search"></i> Find Therapist
                </button>
                
                <div class="therapist-container" id="therapistContainer">
                    <h3><i class="fas fa-user-md"></i> Therapist Finder</h3>
                    <p>Find the right mental health professional for you</p>
                    
                    <div class="search-filters">
                        <div class="filter-group">
                            <label>Specialization:</label>
                            <select id="specialization">
                                <option value="">All Specializations</option>
                                <option value="anxiety">Anxiety</option>
                                <option value="depression">Depression</option>
                                <option value="trauma">Trauma</option>
                                <option value="relationships">Relationships</option>
                                <option value="addiction">Addiction</option>
                                <option value="cbt">Cognitive Behavioral Therapy</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Location:</label>
                            <input type="text" id="location" placeholder="Enter your city">
                        </div>
                        <div class="filter-group">
                            <label>Insurance:</label>
                            <select id="insurance">
                                <option value="">Any Insurance</option>
                                <option value="bluecross">Blue Cross</option>
                                <option value="aetna">Aetna</option>
                                <option value="cigna">Cigna</option>
                                <option value="united">United Health</option>
                            </select>
                        </div>
                        <button onclick="searchTherapists()" class="control-btn">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                    
                    <div class="therapists-list" id="therapistsList">
                        <div class="therapist-card">
                            <div class="therapist-avatar">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div class="therapist-info">
                                <h4>Dr. Sarah Johnson</h4>
                                <p class="specialization">Anxiety & Depression Specialist</p>
                                <p class="location">📍 New York, NY</p>
                                <div class="therapist-tags">
                                    <span class="tag">CBT</span>
                                    <span class="tag">Anxiety</span>
                                    <span class="tag">Blue Cross</span>
                                </div>
                                <div class="therapist-rating">
                                    <span class="stars">⭐⭐⭐⭐⭐</span>
                                    <span>(127 reviews)</span>
                                </div>
                            </div>
                            <div class="therapist-actions">
                                <button class="control-btn">View Profile</button>
                                <button class="control-btn secondary">Book Session</button>
                            </div>
                        </div>
                        
                        <div class="therapist-card">
                            <div class="therapist-avatar">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div class="therapist-info">
                                <h4>Dr. Michael Chen</h4>
                                <p class="specialization">Trauma & PTSD Specialist</p>
                                <p class="location">📍 Los Angeles, CA</p>
                                <div class="therapist-tags">
                                    <span class="tag">EMDR</span>
                                    <span class="tag">Trauma</span>
                                    <span class="tag">Aetna</span>
                                </div>
                                <div class="therapist-rating">
                                    <span class="stars">⭐⭐⭐⭐⭐</span>
                                    <span>(89 reviews)</span>
                                </div>
                            </div>
                            <div class="therapist-actions">
                                <button class="control-btn">View Profile</button>
                                <button class="control-btn secondary">Book Session</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="resource-card interactive" onclick="showBreathingMethods()">
                <div class="resource-icon breathing">
                    <i class="fas fa-wind"></i>
                </div>
                <div class="category">Breathing Techniques</div>
                <h3>Breathing Methods</h3>
                <p>Learn different breathing techniques for stress relief, anxiety management, and better sleep.</p>
                <button class="btn" onclick="showBreathingMethods()">
                    <i class="fas fa-lungs"></i> Try Methods
                </button>
                
                <div class="breathing-methods-container" id="breathingMethodsContainer">
                    <h3><i class="fas fa-wind"></i> Breathing Techniques</h3>
                    <p>Choose a breathing method to practice</p>
                    
                    <div class="breathing-methods-grid">
                        <div class="breathing-method" onclick="selectBreathingMethod('box')">
                            <div class="method-icon">
                                <i class="fas fa-square"></i>
                            </div>
                            <h4>Box Breathing</h4>
                            <p>4-4-4-4 pattern for stress relief</p>
                            <small>Inhale 4s, Hold 4s, Exhale 4s, Hold 4s</small>
                        </div>
                        
                        <div class="breathing-method" onclick="selectBreathingMethod('478')">
                            <div class="method-icon">
                                <i class="fas fa-moon"></i>
                            </div>
                            <h4>4-7-8 Breathing</h4>
                            <p>For better sleep and anxiety</p>
                            <small>Inhale 4s, Hold 7s, Exhale 8s</small>
                        </div>
                        
                        <div class="breathing-method" onclick="selectBreathingMethod('triangle')">
                            <div class="method-icon">
                                <i class="fas fa-play"></i>
                            </div>
                            <h4>Triangle Breathing</h4>
                            <p>Equal parts for balance</p>
                            <small>Inhale 4s, Hold 4s, Exhale 4s</small>
                        </div>
                        
                        <div class="breathing-method" onclick="selectBreathingMethod('alternate')">
                            <div class="method-icon">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <h4>Alternate Nostril</h4>
                            <p>For focus and clarity</p>
                            <small>Alternate nostrils while breathing</small>
                        </div>
                    </div>
                    
                    <div class="breathing-practice" id="breathingPractice" style="display: none;">
                        <h4 id="methodTitle">Breathing Practice</h4>
                        <p id="methodDescription">Follow the pattern below</p>
                        
                        <div class="breathing-visual" id="breathingVisual">
                            <div class="breathing-circle" id="practiceCircle">
                                <span id="practiceInstruction">Ready</span>
                            </div>
                        </div>
                        
                        <div class="breathing-text" id="practiceText">Select a method to begin</div>
                        
                        <div class="breathing-steps" id="breathingSteps"></div>
                        
                        <div class="control-buttons">
                            <button class="control-btn" id="startPracticeBtn" onclick="startBreathingPractice()">
                                <i class="fas fa-play"></i> Start Practice
                            </button>
                            <button class="control-btn secondary" id="stopPracticeBtn" onclick="stopBreathingPractice()" disabled>
                                <i class="fas fa-stop"></i> Stop
                            </button>
                            <audio id="breathingSound" src="{{ url_for('static', filename='inhale-exhale.mp3') }}" preload="auto"></audio>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="resources-grid" id="dynamicResources">
            <!-- Dynamic resources will be loaded here -->
        </div>
    </div>

    <script>
        let authToken = localStorage.getItem('authToken');
        
        // Check if user is logged in
        if (!authToken) {
            window.location.href = '/login';
        }
        
        // Load featured resources
        async function loadFeaturedResources() {
            try {
                const response = await fetch('/api/resources/featured');
                
                if (response.ok) {
                    const resources = await response.json();
                    const container = document.getElementById('featuredResources');
                    
                    if (resources.length === 0) {
                        container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No featured resources available at the moment.</div>';
                        return;
                    }
                    
                    container.innerHTML = resources.map(resource => `
                        <div class="featured-resource">
                            <h4>${resource.title}</h4>
                            <p>${resource.description}</p>
                            <a href="${resource.url}" class="resource-link" target="_blank">
                                <i class="fas fa-external-link-alt"></i> Learn More
                            </a>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading featured resources:', error);
            }
        }
        
        // Load all resources
        async function loadAllResources() {
            try {
                const response = await fetch('/api/resources');
                
                if (response.ok) {
                    const resources = await response.json();
                    const container = document.getElementById('dynamicResources');
                    
                    if (resources.length === 0) {
                        container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No additional resources available.</div>';
                        return;
                    }
                    
                    // You can add more dynamic resources here if needed
                }
            } catch (error) {
                console.error('Error loading resources:', error);
            }
        }
        
        // Initialize
        loadFeaturedResources();
        loadAllResources();

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadResources();
            loadSavedData();
            loadExerciseHistory();
            
            // Check if it's a new day and reset water if needed
            const lastWaterDate = localStorage.getItem('mentalHealthWaterDate');
            const today = new Date().toDateString();
            
            if (lastWaterDate !== today) {
                // New day, reset water glasses
                waterGlasses = 0;
                saveWater();
                localStorage.setItem('mentalHealthWaterDate', today);
            } else {
                // Same day, load saved water
                const savedWater = localStorage.getItem('mentalHealthWater');
                if (savedWater) {
                    waterGlasses = parseInt(savedWater);
                    updateWaterDisplay();
                }
            }
            
            console.log('All data loaded from localStorage');
        });

        // Resources page functionality
        function loadResources() {
            // Resources are static for now
            console.log('Resources loaded');
        }
        
        // Meditation functionality
        let meditationInterval;
        let meditationTimer;
        let breathCount = 0;
        let sessionCount = 0;
        let isBreathingIn = true;
        let meditationStartTime;
        
        function showMeditation() {
            document.getElementById('meditationContainer').style.display = 'block';
            document.getElementById('exerciseContainer').style.display = 'none';
        }
        
        function startMeditation() {
            const startBtn = document.getElementById('startMeditationBtn');
            const pauseBtn = document.getElementById('pauseMeditationBtn');
            const stopBtn = document.getElementById('stopMeditationBtn');

            startBtn.disabled = true;
            pauseBtn.disabled = false;
            stopBtn.disabled = false;

            meditationStartTime = Date.now();
            breathCount = 0;

            // Play breathing audio
            document.getElementById('breathingSound').play();

            // Start breathing cycle
            startBreathingCycle();

            // Start timer
            meditationTimer = setInterval(updateMeditationTime, 1000);
        }
        
        function pauseMeditation() {
            const startBtn = document.getElementById('startMeditationBtn');
            const pauseBtn = document.getElementById('pauseMeditationBtn');
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            
            clearInterval(meditationInterval);
            clearInterval(meditationTimer);
            
            document.getElementById('breathingText').textContent = 'Paused';

             

            
        }
        
        function stopMeditation() {
            const startBtn = document.getElementById('startMeditationBtn');
            const pauseBtn = document.getElementById('pauseMeditationBtn');
            const stopBtn = document.getElementById('stopMeditationBtn');
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            stopBtn.disabled = true;
            
            clearInterval(meditationInterval);
            clearInterval(meditationTimer);
            
            document.getElementById('breathingText').textContent = 'Session completed!';
            document.getElementById('breathingCircle').style.transform = 'scale(1)';
            document.getElementById('breathingInstruction').textContent = 'Ready';
            document.getElementById('meditationProgress').style.width = '0%';
            
            sessionCount++;
            document.getElementById('sessionCount').textContent = sessionCount;
            
            // Save meditation session to API
            const elapsed = Math.floor((Date.now() - meditationStartTime) / 1000);
            if (elapsed > 0) {
                saveMeditationToAPI('basic', 'Breathing Meditation', elapsed, breathCount);
            }
            
            saveSessionCount(); // Save to localStorage as backup
        }
        
        function startBreathingCycle() {
            let cycleTime = 0;
            const totalCycleTime = 4000; // 8 seconds per breath cycle (4s inhale, 4s exhale)
            
            meditationInterval = setInterval(() => {
                cycleTime += 100;
                const progress = (cycleTime / totalCycleTime) * 100;
                document.getElementById('meditationProgress').style.width = progress + '%';
                
                if (cycleTime <= 2000) {
                    // Inhale phase
                    if (isBreathingIn) {
                        document.getElementById('breathingText').textContent = 'Breathe In...';
                        document.getElementById('breathingInstruction').textContent = 'Inhale';
                        document.getElementById('breathingCircle').style.transform = 'scale(1.3)';
                        isBreathingIn = false;
                    }
                } else {
                    // Exhale phase
                    if (!isBreathingIn) {
                        document.getElementById('breathingText').textContent = 'Breathe Out...';
                        document.getElementById('breathingInstruction').textContent = 'Exhale';
                        document.getElementById('breathingCircle').style.transform = 'scale(1)';
                        isBreathingIn = true;
                        breathCount++;
                        document.getElementById('breathCount').textContent = breathCount;
                        saveBreathCount(); // Save to localStorage
                    }
                }
                
                if (cycleTime >= totalCycleTime) {
                    cycleTime = 0;
                }
            }, 100);
        }
        
        function updateMeditationTime() {
            const elapsed = Math.floor((Date.now() - meditationStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('meditationTime').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Exercise functionality
        let exerciseInterval;
        let exerciseTimer;
        let selectedExercise = null;
        let exerciseStartTime;
        let exerciseDuration = 0;
        let exerciseHistory = [];
        
        // Save exercise history
        function saveExerciseHistory() {
            localStorage.setItem('mentalHealthExerciseHistory', JSON.stringify(exerciseHistory));
        }
        
        // Load exercise history
        function loadExerciseHistory() {
            const savedHistory = localStorage.getItem('mentalHealthExerciseHistory');
            if (savedHistory) {
                exerciseHistory = JSON.parse(savedHistory);
            }
        }
        
        const exercises = {
            'jumping-jacks': {
                name: 'Jumping Jacks',
                duration: 300, // 5 minutes
                description: 'Stand with feet together, jump and spread legs while raising arms above head, then return to starting position.'
            },
            'push-ups': {
                name: 'Push-ups',
                duration: 180, // 3 minutes
                description: 'Start in plank position, lower body until chest nearly touches ground, then push back up.'
            },
            'squats': {
                name: 'Squats',
                duration: 240, // 4 minutes
                description: 'Stand with feet shoulder-width apart, lower body as if sitting in a chair, then stand back up.'
            },
            'plank': {
                name: 'Plank',
                duration: 120, // 2 minutes
                description: 'Hold a push-up position with arms straight, keeping body in a straight line from head to heels.'
            },
            'burpees': {
                name: 'Burpees',
                duration: 300, // 5 minutes
                description: 'Start standing, drop into squat, kick feet back to plank, do push-up, jump feet forward, jump up.'
            },
            'custom': {
                name: 'Custom Exercise',
                duration: 180, // 3 minutes default
                description: 'Choose your own exercise and set a custom duration.'
            }
        };
        
        function showExercise() {
            document.getElementById('exerciseContainer').style.display = 'block';
            document.getElementById('meditationContainer').style.display = 'none';
            document.getElementById('nutritionContainer').style.display = 'none';
            document.getElementById('therapistContainer').style.display = 'none';
            document.getElementById('breathingMethodsContainer').style.display = 'none';
        }
        
        function selectExercise(exerciseType) {
            // Remove previous selection
            document.querySelectorAll('.exercise-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selection to clicked item
            event.target.closest('.exercise-item').classList.add('selected');
            
            selectedExercise = exerciseType;
            const exercise = exercises[exerciseType];
            
            // Show exercise details
            document.getElementById('exerciseTitle').textContent = exercise.name;
            document.getElementById('exerciseDescription').textContent = exercise.description;
            document.getElementById('exerciseInstructions').style.display = 'block';
            
            // Enable start button
            document.getElementById('startExerciseBtn').disabled = false;
            
            // Set duration
            exerciseDuration = exercise.duration;
            
            // Show timer
            document.getElementById('exerciseTimer').style.display = 'block';
            document.getElementById('exerciseProgressBar').style.display = 'block';
            
            // Update timer display
            const minutes = Math.floor(exerciseDuration / 60);
            const seconds = exerciseDuration % 60;
            document.getElementById('exerciseTimer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function startExercise() {
            if (!selectedExercise) return;
            
            const startBtn = document.getElementById('startExerciseBtn');
            const pauseBtn = document.getElementById('pauseExerciseBtn');
            const stopBtn = document.getElementById('stopExerciseBtn');
            
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            stopBtn.disabled = false;
            
            exerciseStartTime = Date.now();
            let remainingTime = exerciseDuration;
            
            exerciseTimer = setInterval(() => {
                remainingTime--;
                
                if (remainingTime <= 0) {
                    stopExercise();
                    
                    // Add to exercise history
                    const exerciseRecord = {
                        name: exercises[selectedExercise].name,
                        duration: exerciseDuration,
                        completedAt: new Date().toISOString(),
                        date: new Date().toDateString()
                    };
                    exerciseHistory.push(exerciseRecord);
                    saveExerciseHistory();
                    
                    alert('Exercise completed! Great job!');
                    return;
                }
                
                const minutes = Math.floor(remainingTime / 60);
                const seconds = remainingTime % 60;
                document.getElementById('exerciseTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const progress = ((exerciseDuration - remainingTime) / exerciseDuration) * 100;
                document.getElementById('exerciseProgress').style.width = progress + '%';
            }, 1000);
        }
        
        function pauseExercise() {
            const startBtn = document.getElementById('startExerciseBtn');
            const pauseBtn = document.getElementById('pauseExerciseBtn');
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            
            clearInterval(exerciseTimer);
        }
        
        function stopExercise() {
            const startBtn = document.getElementById('startExerciseBtn');
            const pauseBtn = document.getElementById('pauseExerciseBtn');
            const stopBtn = document.getElementById('stopExerciseBtn');
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            stopBtn.disabled = true;
            
            clearInterval(exerciseTimer);
            
            document.getElementById('exerciseTimer').textContent = '00:00';
            document.getElementById('exerciseProgress').style.width = '0%';
            
            // Save exercise completion to API
            if (selectedExercise && exerciseDuration > 0) {
                const exercise = exercises[selectedExercise];
                saveExerciseToAPI(selectedExercise, exercise.name, exerciseDuration);
            }
        }
        
        // Reset daily data function
        async function resetDailyData() {
            if (confirm('Are you sure you want to reset all daily data? This will clear today\'s meals, water intake, and exercise progress.')) {
                // Reset water for today
                waterGlasses = 0;
                
                // Try to reset via API
                try {
                    await apiCall('/api/nutrition/reset-daily', 'POST');
                } catch (error) {
                    console.log('API reset failed, using localStorage:', error);
                    saveWater();
                }
                
                // Remove today's meals
                const today = new Date().toDateString();
                meals = meals.filter(meal => meal.date !== today);
                saveMeals();
                updateMealsList();
                
                updateNutritionStats();
                updateWaterDisplay();
                alert('Daily data has been reset!');
            }
        }
        
        // Update activity statistics
        function updateActivityStats(stats) {
            if (stats) {
                // Update meditation stats if elements exist
                const breathCountElement = document.getElementById('breathCount');
                const sessionCountElement = document.getElementById('sessionCount');
                
                if (breathCountElement) {
                    breathCountElement.textContent = stats.total_breaths || 0;
                }
                
                if (sessionCountElement) {
                    sessionCountElement.textContent = stats.meditations || 0;
                }
            }
        }
        
        // Nutrition functionality
        let meals = [];
        let waterGlasses = 0;
        
        // API functions for database operations
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(endpoint, options);
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'API call failed');
                }
                
                return result;
            } catch (error) {
                console.error('API Error:', error);
                // Fallback to localStorage if API fails
                return null;
            }
        }
        
        // Load saved data from API or localStorage
        async function loadSavedData() {
            try {
                // Try to load from API first
                const today = new Date().toISOString().split('T')[0];
                const nutritionData = await apiCall(`/api/nutrition/daily/${today}`);
                
                if (nutritionData) {
                    meals = nutritionData.meals || [];
                    waterGlasses = nutritionData.total_water_glasses || 0;
                    updateMealsList();
                    updateWaterDisplay();
                    updateNutritionStats();
                } else {
                    // Fallback to localStorage
                    loadFromLocalStorage();
                }
                
                // Load activity stats
                const activityStats = await apiCall('/api/activities/stats');
                if (activityStats) {
                    updateActivityStats(activityStats.today);
                }
                
            } catch (error) {
                console.log('Falling back to localStorage:', error);
                loadFromLocalStorage();
            }
        }
        
        // Fallback to localStorage
        function loadFromLocalStorage() {
            const savedMeals = localStorage.getItem('mentalHealthMeals');
            if (savedMeals) {
                meals = JSON.parse(savedMeals);
                updateMealsList();
            }
            
            const savedWater = localStorage.getItem('mentalHealthWater');
            if (savedWater) {
                waterGlasses = parseInt(savedWater);
                updateWaterDisplay();
            }
            
            updateNutritionStats();
        }
        
        // Save data to localStorage (fallback functions)
        function saveMeals() {
            localStorage.setItem('mentalHealthMeals', JSON.stringify(meals));
        }
        
        function saveWater() {
            localStorage.setItem('mentalHealthWater', waterGlasses.toString());
        }
        
        function saveBreathCount() {
            localStorage.setItem('mentalHealthBreathCount', breathCount.toString());
        }
        
        function saveSessionCount() {
            localStorage.setItem('mentalHealthSessionCount', sessionCount.toString());
        }
        
        // Save data to API or localStorage
        async function saveMealToAPI(mealName, mealType) {
            try {
                const result = await apiCall('/api/nutrition/meal', 'POST', {
                    name: mealName,
                    type: mealType
                });
                
                if (result) {
                    return result.meal;
                }
            } catch (error) {
                console.log('API save failed, using localStorage:', error);
            }
            return null;
        }
        
        async function saveWaterToAPI(glasses) {
            try {
                const result = await apiCall('/api/nutrition/water', 'POST', {
                    glasses: glasses
                });
                
                if (result) {
                    return result.water;
                }
            } catch (error) {
                console.log('API save failed, using localStorage:', error);
            }
            return null;
        }
        
        async function saveExerciseToAPI(exerciseType, exerciseName, durationSeconds) {
            try {
                const result = await apiCall('/api/exercise/complete', 'POST', {
                    exercise_type: exerciseType,
                    exercise_name: exerciseName,
                    duration_seconds: durationSeconds
                });
                
                if (result) {
                    return result.exercise;
                }
            } catch (error) {
                console.log('API save failed, using localStorage:', error);
            }
            return null;
        }
        
        async function saveMeditationToAPI(sessionType, sessionName, durationSeconds, breathCount) {
            try {
                const result = await apiCall('/api/meditation/complete', 'POST', {
                    session_type: sessionType,
                    session_name: sessionName,
                    duration_seconds: durationSeconds,
                    breath_count: breathCount
                });
                
                if (result) {
                    return result.meditation;
                }
            } catch (error) {
                console.log('API save failed, using localStorage:', error);
            }
            return null;
        }
        
        async function saveBreathingToAPI(methodType, methodName, durationSeconds, cyclesCompleted) {
            try {
                const result = await apiCall('/api/breathing/complete', 'POST', {
                    method_type: methodType,
                    method_name: methodName,
                    duration_seconds: durationSeconds,
                    cycles_completed: cyclesCompleted
                });
                
                if (result) {
                    return result.breathing;
                }
            } catch (error) {
                console.log('API save failed, using localStorage:', error);
            }
            return null;
        }
        
        function showNutrition() {
            document.getElementById('nutritionContainer').style.display = 'block';
            document.getElementById('meditationContainer').style.display = 'none';
            document.getElementById('exerciseContainer').style.display = 'none';
            document.getElementById('therapistContainer').style.display = 'none';
            document.getElementById('breathingMethodsContainer').style.display = 'none';
        }
        
        function showNutritionTab(tab) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
            
            if (tab === 'water') {
                updateWaterDisplay();
            }
        }
        
        async function addMealAsync() {
            const mealName = document.getElementById('mealName').value.trim();
            const mealType = document.getElementById('mealType').value;
            
            if (!mealName) {
                alert('Please enter a meal name');
                return;
            }
            
            // Try to save to API first
            const savedMeal = await saveMealToAPI(mealName, mealType);
            
            if (savedMeal) {
                // API save successful
                meals.push(savedMeal);
            } else {
                // Fallback to localStorage
                const meal = {
                    name: mealName,
                    type: mealType,
                    time: new Date().toLocaleTimeString(),
                    date: new Date().toDateString()
                };
                meals.push(meal);
                saveMeals();
            }
            
            updateMealsList();
            updateNutritionStats();
            document.getElementById('mealName').value = '';
        }
        
        function updateMealsList() {
            const mealsList = document.getElementById('mealsList');
            mealsList.innerHTML = '';
            
            // Filter meals for today only
            const today = new Date().toDateString();
            const todayMeals = meals.filter(meal => meal.date === today);
            
            todayMeals.forEach((meal, index) => {
                const mealItem = document.createElement('div');
                mealItem.className = 'meal-item';
                mealItem.innerHTML = `
                    <div>
                        <strong>${meal.name}</strong>
                        <small>${meal.type} - ${meal.time || meal.entry_time}</small>
                    </div>
                    <button onclick="removeMealAsync(${index})" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                mealsList.appendChild(mealItem);
            });
        }
        
        async function removeMealAsync(index) {
            const today = new Date().toDateString();
            const todayMeals = meals.filter(meal => meal.date === today);
            const mealToRemove = todayMeals[index];
            
            // Try to delete from API if it has an ID
            if (mealToRemove.id) {
                try {
                    await apiCall(`/api/nutrition/meal/${mealToRemove.id}`, 'DELETE');
                } catch (error) {
                    console.log('API delete failed:', error);
                }
            }
            
            // Remove from local array
            const actualIndex = meals.findIndex(meal => 
                meal.name === mealToRemove.name && 
                (meal.time === mealToRemove.time || meal.entry_time === mealToRemove.entry_time) && 
                meal.date === mealToRemove.date
            );
            
            if (actualIndex !== -1) {
                meals.splice(actualIndex, 1);
                updateMealsList();
                updateNutritionStats();
                saveMeals(); // Save to localStorage as backup
            }
        }
        
        function updateNutritionStats() {
            const today = new Date().toDateString();
            const todayMeals = meals.filter(meal => meal.date === today);
            
            document.getElementById('mealsCount').textContent = todayMeals.length;
            document.getElementById('waterGlasses').textContent = waterGlasses;
            
            // Simple mood score based on meals and water
            let moodScore = '😊';
            if (todayMeals.length >= 3 && waterGlasses >= 6) {
                moodScore = '😄';
            } else if (todayMeals.length < 2 || waterGlasses < 4) {
                moodScore = '😐';
            }
            document.getElementById('moodScore').textContent = moodScore;
        }
        
        async function addWaterAsync() {
            waterGlasses++;
            
            // Try to save to API
            const savedWater = await saveWaterToAPI(1);
            
            if (!savedWater) {
                // Fallback to localStorage
                saveWater();
            }
            
            updateNutritionStats();
            updateWaterDisplay();
        }
        
        async function resetWaterAsync() {
            waterGlasses = 0;
            
            // Try to reset via API
            try {
                await apiCall('/api/nutrition/reset-daily', 'POST');
            } catch (error) {
                console.log('API reset failed, using localStorage:', error);
                saveWater(); // Save to localStorage as backup
            }
            
            updateNutritionStats();
            updateWaterDisplay();
        }
        
        function updateWaterDisplay() {
            const waterDisplay = document.getElementById('waterGlassesDisplay');
            waterDisplay.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                const glass = document.createElement('div');
                glass.className = `water-glass ${i < waterGlasses ? 'filled' : ''}`;
                waterDisplay.appendChild(glass);
            }
        }
        
        // Therapist functionality
        function showTherapist() {
            document.getElementById('therapistContainer').style.display = 'block';
            document.getElementById('meditationContainer').style.display = 'none';
            document.getElementById('exerciseContainer').style.display = 'none';
            document.getElementById('nutritionContainer').style.display = 'none';
            document.getElementById('breathingMethodsContainer').style.display = 'none';
        }
        
        function searchTherapists() {
            const specialization = document.getElementById('specialization').value;
            const location = document.getElementById('location').value;
            const insurance = document.getElementById('insurance').value;
            
            // Simulate search - in real app, this would call an API
            console.log('Searching for therapists with:', { specialization, location, insurance });
            
            // Show loading or update results
            alert('Search completed! (This is a demo - in a real app, this would show actual therapist results)');
        }
        
        // Breathing Methods functionality
        let selectedBreathingMethod = null;
        let breathingPracticeInterval;
        let currentStep = 0;
        
        const breathingMethods = {
            'box': {
                name: 'Box Breathing',
                description: 'Equal breathing pattern for stress relief',
                steps: [
                    { name: 'Inhale', duration: 4, instruction: 'Breathe in slowly' },
                    { name: 'Hold', duration: 4, instruction: 'Hold your breath' },
                    { name: 'Exhale', duration: 4, instruction: 'Breathe out slowly' },
                    { name: 'Hold', duration: 4, instruction: 'Hold empty' }
                ]
            },
            '478': {
                name: '4-7-8 Breathing',
                description: 'Relaxing pattern for sleep and anxiety',
                steps: [
                    { name: 'Inhale', duration: 4, instruction: 'Breathe in through nose' },
                    { name: 'Hold', duration: 7, instruction: 'Hold breath' },
                    { name: 'Exhale', duration: 8, instruction: 'Breathe out through mouth' }
                ]
            },
            'triangle': {
                name: 'Triangle Breathing',
                description: 'Balanced breathing for focus',
                steps: [
                    { name: 'Inhale', duration: 4, instruction: 'Breathe in' },
                    { name: 'Hold', duration: 4, instruction: 'Hold' },
                    { name: 'Exhale', duration: 4, instruction: 'Breathe out' }
                ]
            },
            'alternate': {
                name: 'Alternate Nostril',
                description: 'Focus and clarity breathing',
                steps: [
                    { name: 'Right Inhale', duration: 4, instruction: 'Inhale through right nostril' },
                    { name: 'Hold', duration: 4, instruction: 'Hold breath' },
                    { name: 'Left Exhale', duration: 4, instruction: 'Exhale through left nostril' },
                    { name: 'Left Inhale', duration: 4, instruction: 'Inhale through left nostril' },
                    { name: 'Hold', duration: 4, instruction: 'Hold breath' },
                    { name: 'Right Exhale', duration: 4, instruction: 'Exhale through right nostril' }
                ]
            }
        };
        
        function showBreathingMethods() {
            document.getElementById('breathingMethodsContainer').style.display = 'block';
            document.getElementById('meditationContainer').style.display = 'none';
            document.getElementById('exerciseContainer').style.display = 'none';
            document.getElementById('nutritionContainer').style.display = 'none';
            document.getElementById('therapistContainer').style.display = 'none';
        }
        
        function selectBreathingMethod(method) {
            selectedBreathingMethod = method;
            const breathingMethod = breathingMethods[method];
            
            document.getElementById('methodTitle').textContent = breathingMethod.name;
            document.getElementById('methodDescription').textContent = breathingMethod.description;
            document.getElementById('breathingPractice').style.display = 'block';
            
            // Create step indicators
            const stepsContainer = document.getElementById('breathingSteps');
            stepsContainer.innerHTML = '';
            
            breathingMethod.steps.forEach((step, index) => {
                const stepIndicator = document.createElement('div');
                stepIndicator.className = 'step-indicator';
                stepIndicator.textContent = index + 1;
                stepIndicator.title = `${step.name} (${step.duration}s)`;
                stepsContainer.appendChild(stepIndicator);
            });
            
            // Enable start button
            document.getElementById('startPracticeBtn').disabled = false;
        }
        
        function startBreathingPractice() {
            if (!selectedBreathingMethod) return;
            
            const startBtn = document.getElementById('startPracticeBtn');
            const stopBtn = document.getElementById('stopPracticeBtn');
            
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            const method = breathingMethods[selectedBreathingMethod];
            currentStep = 0;
            
            function runBreathingCycle() {
                const step = method.steps[currentStep];
                const stepIndicators = document.querySelectorAll('.step-indicator');
                
                // Update visual indicators
                stepIndicators.forEach((indicator, index) => {
                    indicator.classList.remove('active', 'completed');
                    if (index < currentStep) {
                        indicator.classList.add('completed');
                    } else if (index === currentStep) {
                        indicator.classList.add('active');
                    }
                });
                
                // Update breathing circle and text
                document.getElementById('practiceInstruction').textContent = step.name;
                document.getElementById('practiceText').textContent = step.instruction;
                
                // Animate breathing circle
                const circle = document.getElementById('practiceCircle');
                if (step.name.includes('Inhale')) {
                    circle.style.transform = 'scale(1.3)';
                } else if (step.name.includes('Exhale')) {
                    circle.style.transform = 'scale(1)';
                }
                
                // Move to next step after duration
                setTimeout(() => {
                    currentStep = (currentStep + 1) % method.steps.length;
                    if (!document.getElementById('stopPracticeBtn').disabled) {
                        runBreathingCycle();
                    }
                }, step.duration * 1000);
            }
            document.getElementById('breathingSound').play();

            
            runBreathingCycle();
        }
        
        function stopBreathingPractice() {
            const startBtn = document.getElementById('startPracticeBtn');
            const stopBtn = document.getElementById('stopPracticeBtn');
            
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            // Reset visual elements
            document.getElementById('practiceInstruction').textContent = 'Ready';
            document.getElementById('practiceText').textContent = 'Select a method to begin';
            document.getElementById('practiceCircle').style.transform = 'scale(1)';
            
            // Reset step indicators
            document.querySelectorAll('.step-indicator').forEach(indicator => {
                indicator.classList.remove('active', 'completed');
            });
        }
    </script>
</body>
</html> 