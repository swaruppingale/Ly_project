<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Mental Health Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            min-height: 100vh;
        }
        
        .navbar {
            background: linear-gradient(90deg, #b2cfe8 0%, #4a6567 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .navbar-brand i {
            font-size: 2rem;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .nav-link:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .nav-link.active {
            background: rgba(255,255,255,0.3);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .page-header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            background: linear-gradient(135deg, #fef9f3, #e0f0f5);
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.15s ease-in-out;
        }
        
        .page-header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .page-header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .profile-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            background: linear-gradient(135deg, #fef9f3, #e0f0f5);
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.15s ease-in-out;
        }
        
        .profile-section h2 {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #6B73FF;
            background: white;
            box-shadow: 0 0 0 3px rgba(107, 115, 255, 0.1);
        }
        
        .form-group input:disabled {
            background: #e9ecef;
            color: #6c757d;
        }
        
        .btn {
            background: linear-gradient(135deg, #6B73FF 0%, #8B5CF6 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(107, 115, 255, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .response {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            display: none;
        }
        
        .response.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .response.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6B73FF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6B73FF 0%, #8B5CF6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            margin: 0 auto 20px;
        }
        
        .account-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 600;
            color: #6B73FF;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .danger-zone {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .danger-zone h3 {
            color: #c53030;
            margin-bottom: 10px;
        }
        
        .danger-zone p {
            color: #666;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">
            <i class="fas fa-brain"></i>
            <span>Mental Health Platform</span>
        </div>
        <div class="nav-links">
            <a href="/dashboard" class="nav-link">Dashboard</a>
            <a href="/mood" class="nav-link">Mood</a>
            <a href="/journal" class="nav-link">Journal</a>
            <a href="/resources" class="nav-link">Resources</a>
            <a href="/analytics" class="nav-link">Analytics</a>
            <a href="/profile" class="nav-link active">Profile</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-user"></i> Profile Settings</h1>
            <p>Manage your account settings and personal information</p>
        </div>
        
        <div class="profile-section">
            <h2><i class="fas fa-user-circle"></i> Personal Information</h2>
            
            <div class="profile-avatar">
                <i class="fas fa-user"></i>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-user"></i> Username</label>
                <input type="text" id="username" disabled>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-envelope"></i> Email</label>
                <input type="email" id="email" disabled>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-calendar"></i> Member Since</label>
                <input type="text" id="memberSince" disabled>
            </div>
            
            <div class="account-stats">
                <div class="stat-item">
                    <div class="stat-number" id="moodCount">-</div>
                    <div class="stat-label">Mood Entries</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="journalCount">-</div>
                    <div class="stat-label">Journal Entries</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="streakDays">-</div>
                    <div class="stat-label">Current Streak</div>
                </div>
            </div>
        </div>
        
        <div class="profile-section">
            <h2><i class="fas fa-lock"></i> Change Password</h2>
            
            <div class="form-group">
                <label><i class="fas fa-lock"></i> Current Password</label>
                <input type="password" id="currentPassword" placeholder="Enter your current password">
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-key"></i> New Password</label>
                <input type="password" id="newPassword" placeholder="Enter your new password">
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-key"></i> Confirm New Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm your new password">
            </div>
            
            <button class="btn" onclick="changePassword()" id="passwordBtn">
                <i class="fas fa-save"></i> Change Password
            </button>
            
            <div id="passwordResponse" class="response"></div>
        </div>
        
        <div class="profile-section">
            <h2><i class="fas fa-cog"></i> Account Settings</h2>
            
            <div class="form-group">
                <label><i class="fas fa-bell"></i> Email Notifications</label>
                <select id="emailNotifications">
                    <option value="daily">Daily reminders</option>
                    <option value="weekly">Weekly summaries</option>
                    <option value="none">No notifications</option>
                </select>
            </div>
            
            <button class="btn" onclick="updateSettings()" id="settingsBtn">
                <i class="fas fa-save"></i> Save Settings
            </button>
            
            <div id="settingsResponse" class="response"></div>
        </div>
        
        <div class="profile-section">
            <h2><i class="fas fa-download"></i> Data Export</h2>
            <p>Download your data for backup or transfer purposes.</p>
            
            <button class="btn btn-secondary" onclick="exportData()" id="exportBtn">
                <i class="fas fa-download"></i> Export My Data
            </button>
            
            <div id="exportResponse" class="response"></div>
        </div>
        
        <div class="profile-section">
            <div class="danger-zone">
                <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
                <p>Once you delete your account, there is no going back. Please be certain.</p>
                
                <button class="btn btn-danger" onclick="deleteAccount()" id="deleteBtn">
                    <i class="fas fa-trash"></i> Delete Account
                </button>
                
                <div id="deleteResponse" class="response"></div>
            </div>
        </div>
    </div>

    <script>
        let authToken = localStorage.getItem('authToken');
        
        // Check if user is logged in
        if (!authToken) {
            window.location.href = '/login';
        }
        
        // Load user profile
        async function loadProfile() {
            try {
                const response = await fetch('/api/user/profile', {
                    headers: { 'Authorization': 'Bearer ' + authToken }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    document.getElementById('username').value = user.username;
                    document.getElementById('email').value = user.email;
                    document.getElementById('memberSince').value = new Date(user.created_at).toLocaleDateString();
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }
        
        // Load user stats
        async function loadStats() {
            try {
                const response = await fetch('/api/mood/analytics', {
                    headers: { 'Authorization': 'Bearer ' + authToken }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('moodCount').textContent = data.total_entries || 0;
                    document.getElementById('streakDays').textContent = data.current_streak || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
            
            try {
                const response = await fetch('/api/journal/analytics', {
                    headers: { 'Authorization': 'Bearer ' + authToken }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('journalCount').textContent = data.total_entries || 0;
                } else {
                    console.error('Failed to load journal analytics:', response.status);
                }
            } catch (error) {
                console.error('Error loading journal count:', error);
            }
        }
        
        // Show response
        function showResponse(elementId, message, isSuccess = true) {
            const response = document.getElementById(elementId);
            response.textContent = message;
            response.className = `response ${isSuccess ? 'success' : 'error'}`;
            response.style.display = 'block';
        }
        
        // Show loading
        function showLoading(buttonId) {
            const button = document.getElementById(buttonId);
            const originalText = button.innerHTML;
            button.innerHTML = '<div class="loading"></div> Loading...';
            button.disabled = true;
            return originalText;
        }
        
        // Hide loading
        function hideLoading(buttonId, originalText) {
            const button = document.getElementById(buttonId);
            button.innerHTML = originalText;
            button.disabled = false;
        }
        
        // Change password
        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showResponse('passwordResponse', 'Please fill in all password fields', false);
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showResponse('passwordResponse', 'New passwords do not match', false);
                return;
            }
            
            const originalText = showLoading('passwordBtn');
            
            try {
                const response = await fetch('/api/user/change-password', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + authToken
                    },
                    body: JSON.stringify({
                        current_password: currentPassword,
                        new_password: newPassword
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('passwordResponse', 'Password changed successfully!', true);
                    // Clear form
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                } else {
                    showResponse('passwordResponse', data.message || 'Failed to change password', false);
                }
            } catch (error) {
                showResponse('passwordResponse', 'Error: ' + error.message, false);
            } finally {
                hideLoading('passwordBtn', originalText);
            }
        }
        
        // Update settings
        async function updateSettings() {
            const originalText = showLoading('settingsBtn');
            
            try {
                const response = await fetch('/api/user/settings', {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + authToken
                    },
                    body: JSON.stringify({
                        email_notifications: document.getElementById('emailNotifications').value
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('settingsResponse', 'Settings updated successfully!', true);
                } else {
                    showResponse('settingsResponse', data.message || 'Failed to update settings', false);
                }
            } catch (error) {
                showResponse('settingsResponse', 'Error: ' + error.message, false);
            } finally {
                hideLoading('settingsBtn', originalText);
            }
        }
        
        // Export data
        async function exportData() {
            const originalText = showLoading('exportBtn');
            
            try {
                const response = await fetch('/api/user/export', {
                    headers: { 'Authorization': 'Bearer ' + authToken }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'mental-health-data.json';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    showResponse('exportResponse', 'Data exported successfully!', true);
                } else {
                    showResponse('exportResponse', 'Failed to export data', false);
                }
            } catch (error) {
                showResponse('exportResponse', 'Error: ' + error.message, false);
            } finally {
                hideLoading('exportBtn', originalText);
            }
        }
        
        // Delete account
        async function deleteAccount() {
            if (!confirm('Are you absolutely sure you want to delete your account? This action cannot be undone.')) {
                return;
            }
            
            const originalText = showLoading('deleteBtn');
            
            try {
                const response = await fetch('/api/user/delete', {
                    method: 'DELETE',
                    headers: { 'Authorization': 'Bearer ' + authToken }
                });
                
                if (response.ok) {
                    localStorage.removeItem('authToken');
                    window.location.href = '/login';
                } else {
                    const data = await response.json();
                    showResponse('deleteResponse', data.message || 'Failed to delete account', false);
                }
            } catch (error) {
                showResponse('deleteResponse', 'Error: ' + error.message, false);
            } finally {
                hideLoading('deleteBtn', originalText);
            }
        }
        
        // Initialize
        loadProfile();
        loadStats();
    </script>
</body>
</html> 